<!DOCTYPE html>
<html> 
<head> 
  <meta name="viewport" content="width=device-width;height=device-height; user-scalable=no" /> 
  <meta http-equiv="Content-type" content="text/html;charset=utf-8"> 
  <title>PhoneGap Reverse Geolocation Lookup</title> 
  <script type="text/javascript" src="cordova.js"></script> 
  <script type="text/javascript" src="jquery-1.10.2.js"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=true"></script>            
            
  <script type="text/javascript">
    var geocoder;
      
    $(document).ready(function() {
      geocoder = new google.maps.Geocoder();
                      
      $('#button-get-reverse-lookup').click(function(){
        navigator.geolocation.getCurrentPosition(onGetCurrentPositionSuccess, onGetCurrentPositionError);
      });
    });
          
          var lat; 
          var lng;        
    var onGetCurrentPositionSuccess = function(position) 
    {
      console.log("lat: " + position.coords.latitude);
      console.log("long: " + position.coords.longitude);
      lat = parseFloat(position.coords.latitude);
      lng = parseFloat(position.coords.longitude);
                        
      // paris, france - uncomment to test
      //var lat = parseFloat(48.850258);
      //var lng = parseFloat(2.351074);
                        
      // tiburon, california
      //var lat = parseFloat(37.872685);
      //var lng = parseFloat(-122.45224);
                        
      var latlng = new google.maps.LatLng(lat, lng);
                        
      geocoder.geocode({'latLng': latlng}, function(results, status) 
      {
        if (status == google.maps.GeocoderStatus.OK) 
        {
		      if (results[0]) 
		      {
		      	//browserSupportFlag = true;
					var result = results[0];
					//look for locality tag and administrative_area_level_1
					var city = "";
					var state = "";
					for(var i=0, len=result.address_components.length; i<len; i++) 
					{
						var ac = result.address_components[i];
						if(ac.types.indexOf("locality") >= 0) 
						{
							city = ac.long_name;
						}
						if(ac.types.indexOf("administrative_area_level_1") >= 0) 
						{
							state = ac.long_name;
						}
					}
					alert(city + ", " +state);
					
		      }
			  else 
			  {
				    alert("No results found");
			  }
        } 
        else 
        {
          alert("Geocoder failed due to: " + status);
        }
      });
      alert(lat+" " +lng);
        var mapOptions={center: new google.maps.LatLng(lat,lng), zoom:15, mapTypeId:google.maps.MapTypeId.ROADMAP};
    	var map = new google.maps.Map(document.getElementById("map"),mapOptions);
    }
    

  
    var onGetCurrentPositionError = function(error) 
    { 
      console.log("Couldn't get geo coords from device");
    } 
  </script> 
</head> 
 
<body>
  <h1>Reverse Geolocation Lookup</h1>
  <button id="button-get-reverse-lookup">Get Reverse Lookup</button>
  <div id="map">
  	
  </div>
</body> 
</html> 
